## 250316 íšŒê³  ğŸ’¬
ì™€! ì •ë³´ì²˜ë¦¬ê¸°ì‚¬ ê²°ê³¼ê°€ ì´ë²ˆ ì£¼ì— ë‚˜ì™”ë‹¤. ê²°ê³¼ëŠ” ì˜ˆìƒí•œëŒ€ë¡œ í•©ê²©! ğŸ™ŒğŸ™ŒğŸ™Œ ì•„ì§ ì‹¤ê¸°ë¥¼ ì·¨ë“í•œê±´ ì•„ë‹ˆì§€ë§Œ ì²« ë‹¨ì¶”ë¥¼ ì˜ ë¼ì› ë‹¤ëŠ” ì˜ë¯¸ì—ì„œ ë‚˜ ìì‹  ì¹­ì°¬í•œë‹¤. 4ì›” ì¤‘ì— ì‹¤ê¸° ì‹œí—˜ì´ ìˆë‹¤. ì£¼ë§ë§ˆë‹¤ ê³µë¶€í•´ì„œ í•œë²ˆì— í•©ê²©í•  ìˆ˜ ìˆë„ë¡ í•´ë³´ê² ë‹¤. ì–´ëŠë§ 3ì›”ë„ ì¤‘ìˆœì´ë‹¤. 3ì›”ì˜ ì…‹ì§¸ ì£¼ë¥¼ ë˜ëŒì•„ë³¸ë‹¤.

## Keep ğŸ‘
- SSAFY ì—ì„œ DB ê³µë¶€ë¥¼ í–ˆë‹¤. ëŒ€í•™êµ ìˆ˜ì—…ìœ¼ë¡œ ë“¤ì–´ë³´ê³¤ ëª‡ë…„ë§Œì¸ì§€,,, ì¡°ì¸, ì„œë¸Œì¿¼ë¦¬ ë“± ì˜¤ëœë§Œì— ë³´ëŠ” ì¿¼ë¦¬ë¬¸ì— ëŒ€ëµ ì •ì‹ ì´ ì•„ë“í•´ì¡Œë‹¤. ì„œë¸Œì¿¼ë¦¬ëŠ” ë­ ê·¸ë ‡êµ¬ë‚˜ í•˜ê³  ì´í•´í•˜ê¸° ì‰¬ì› ë‹¤. ê·¸ëŸ°ë° ì¡°ì¸ì€ ê³µë¶€ê°€ í•„ìš”í•  ë“¯ ì‹¶ë‹¤. ê·¸ê°„ JPAë§Œ ì‚¬ìš©í•´ì„œ DB ê³µë¶€ì— ì†Œí™€í–ˆì—ˆë‹¤. ê·¸ëŸ¬ë‹¤ê°€ ì¡°ì¸ ë‚´ìš©ì„ ê³µë¶€í•˜ë‹ˆ ì´í•´í•  ìˆ˜ê°€ ì—†ì—ˆë‹¤. ğŸ˜±ğŸ˜±
- ìë°” io ê³µë¶€ë¥¼ í•˜ê³ ìˆë‹¤. CS ê³µë¶€í•  ë•Œ ì•Œì•„ë‘” ë‚´ìš©ë“¤ì´ ëª‡ëª‡ ìˆì–´ì„œ ë³µìŠµê²¸ ì˜ ë“£ê³  ìˆë‹¤. ë¬¸ìì§‘í•© ê°™ì€ ë‹¨ì–´ê°€ ë‚˜ì˜¤ë©´ ë‚´ê°€ ê·¸ê°„ ê³µë¶€ë¥¼ í•˜ê¸´ í–ˆêµ¬ë‚˜ í•˜ë©´ì„œ ê¸°ë¶„ì´ ì¢‹ë‹¤. ìë°” ioëŠ” ê°œì¸ í”„ë¡œì íŠ¸ í•  ë•Œ ì‚¬ìš©í•´ë³¸ì ì´ ì—†ë‹¤... ì•Œê³ ë¦¬ì¦˜ ê³µë¶€í•  ë•Œë§Œ ì¸í’‹ ë°›ìœ¼ë ¤ê³  ì¨ë´¤ëŠ”ë° ì´ë²ˆ ê¸°íšŒì— ê³µë¶€ë„ í–ˆìœ¼ë‹ˆ ê´€ë ¨í•´ì„œ ê¸°ëŠ¥ì„ í•˜ë‚˜ ë§Œë“¤ì–´ë³¼ê¹Œ ìƒê°ë§Œ í•˜ê³  ìˆë‹¤.
- ê°œì¸ í”„ë¡œì íŠ¸ì— ë©”ì„œë“œê¸°ë°˜ ì¸ì¦ ë¡œì§ì„ êµ¬í˜„í–ˆë‹¤. ì§€ê¸ˆê¹Œì§€ëŠ” ê²½ë¡œ ê¸°ë°˜ìœ¼ë¡œ ì¸ì¦ì„ í™•ì¸í–ˆì—ˆë‹¤. ì‘ì—…í•˜ë©´ì„œ ìƒê°í•´ë´¤ëŠ”ë° ê²½ë¡œ ê¸°ë°˜ìœ¼ë¡œ ì¸ì¦ì„ êµ¬ë¶„í•˜ë©´ ëª¨ë“  ê²½ë¡œë¥¼ securityConfigì— ì•Œë ¤ì¤˜ì•¼í•œë‹¤. ì§€ê¸ˆì€ ê´œì°®ì§€ë§Œ ë‚˜ì¤‘ì— apiê°€ 1000ê°œ(ì´ë ‡ê²Œ ë§ì•„ì§€ê¸´ ì‰½ì§€ ì•Šê² ì§€ë§Œ)ê°€ ëœë‹¤ë©´ ê³¼ì—° ê·¸ í´ë˜ìŠ¤ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆì„ê¹Œ ê±±ì •ì´ ëë‹¤. ê·¸ë˜ì„œ ë©”ì„œë“œ ê¸°ë°˜ ì¸ì¦ìœ¼ë¡œ ì¸ì¦ì¸ê°€ë¥¼ í™•ì¸í•˜ê¸°ë¡œ í–ˆë‹¤.
- ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë° ê¸°ëŠ¥ì„ ì™„ì„±í–ˆë‹¤. ì§€ê¸ˆê¹Œì§€ëŠ” ë¹„ë””ì˜¤ë¥¼ ìš”ì²­í•˜ë©´ ë¹„ë””ì˜¤ ì¬ìƒì‹œ ì›í•˜ëŠ” ë¶€ë¶„ë¶€í„° ì¬ìƒí•˜ëŠ” ê¸°ëŠ¥ì´ ì—†ì–´ì„œ ì²˜ìŒë¶€í„° ëê¹Œì§€ ë‹¤ ë´ì•¼ë§Œ í–ˆë‹¤. StreamingResponseBodyë¥¼ ì‚¬ìš©í•´ì„œ í´ë¼ì´ì–¸íŠ¸ê°€ ë¹„ë””ì˜¤ì˜ ì¤‘ê°„ ì¬ìƒì„ ì›í•˜ë©´ í•´ë‹¹ ë¶€ë¶„ë¶€í„° ìŠ¤íŠ¸ë¦¬ë° í•˜ëŠ” ì‹ìœ¼ë¡œ êµ¬í˜„í–ˆë‹¤.
- ë‹¤ë¥¸ ê¸°ëŠ¥ìœ¼ë¡œëŠ” ê°œì¸ í”„ë¡œí•„ ê´€ë¦¬ ê¸°ëŠ¥ì„ ë§Œë“¤ê³  ìˆë‹¤. íšŒì›ì˜ í”„ë¡œí•„ ì‚¬ì§„, ë°°ê²½ ì‚¬ì§„, ìê¸° ì†Œê°œ ë“±ì„ ê´€ë¦¬í•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤. ì•„ì§ì€ ë°±ì—”ë“œë§Œ ì™„ë£Œëë‹¤. ê·¸ë¦¬ê³  í”„ë¡ íŠ¸ë¥¼ í•´ì•¼í•˜ëŠ”ë°,,, ì†ì´ ì•ˆ ê°„ë‹¤. ê·¸ë˜ì„œ ë ˆìŠ¤íŠ¸ ë…ìŠ¤ë¥¼ ë§Œë“¤ì–´ë³´ê³  ìˆë‹¤.
- ì„œë¹„ìŠ¤ ë‹¨ ì½”ë“œì— ë¡œì§ì„ ëª¨ë‘ ë„£ì–´ë³´ë ¤ê³  í–ˆì§€ë§Œ ê·¸ëŸ¬ë©´ ì‹œê°ì ìœ¼ë¡œ ë„ˆë¬´ í˜ë“¤ë‹¤. ê·¸ë˜ì„œ ìœ í‹¸ í´ë˜ìŠ¤ë¡œ ë¶„ë¦¬í•´ì„œ í•´ë‹¹ ë¡œì§ì„ ëª¨ë‘ ìœ„ì„í•˜ê³  ìˆë‹¤. ìœ í‹¸ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ ë•Œ staticìœ¼ë¡œ ë§Œë“¤ì§€, @Componentë¡œ ë§Œë“¤ì§€ ê³ ë¯¼ì„ ë§ì´ í–ˆë‹¤. ê²°ë¡ ì€ @Component ë¥¼ ì‚¬ìš©í•´ì„œ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ê´€ë¦¬í•˜ê¸°ë¡œ ê²°ì •í–ˆë‹¤. ë‚˜ì¤‘ì— í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±í•  ë•Œ ëª¨í‚¹í•˜ë ¤ë©´ ë¹ˆìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ”ê²Œ í¸í•˜ê¸° ë•Œë¬¸ì´ë‹¤. ë‚˜ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±í•˜ëŠ”ê±° ì¢‹ì•„í•˜ë‹ˆê¹Œ,,, í›„ìš±í›„ìš± ë²Œì¨ë¶€í„° í…ŒìŠ¤íŠ¸ ì½”ë“œ ê³ ë„í™” í•  ìƒê°ì— ì„¤ë ˆê¸° ì‹œì‘í•œë‹¤.ğŸ¥°

```text
í…ŒìŠ¤íŠ¸ ì½”ë“œ ê³ ë„í™” ì˜ˆì •
RestDocs -> mockMvc test  
UtillClass -> mockito test  
Repository -> DataJpaTest  
Service, controller -> SpringBootTest
```

- ë°±ì—”ë“œ
	- ë©”ì„œë“œ ê¸°ë°˜ ì¸ì¦ì¸ê°€ ì²´í¬ ë¡œì§
	- ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë° ë¡œì§ ê°œì„ 
	- í”„ë¡œí•„ ê´€ë¦¬ ê¸°ëŠ¥

## Try ğŸ§š
- í† ì´ í”„ë¡œì íŠ¸ ì‘ì—…
	- ë°±ì—”ë“œ
		- ë ˆìŠ¤íŠ¸ ë…ìŠ¤ êµ¬í˜„
		- í…ŒìŠ¤íŠ¸ ì½”ë“œ ê³ ë„í™”
		- ë¹„ë””ì˜¤ ê´€ë¦¬ ê¸°ëŠ¥
	- í”„ë¡ íŠ¸ì—”ë“œ
		- ê°œì¸ í”„ë¡œí•„ í™”ë©´ ì œì‘
		- ë¹„ë””ì˜¤ ê´€ë¦¬ ê¸°ëŠ¥ í™”ë©´

## ë…ì„œ ëª©ë¡

### ì„œí‰ ì™„ë£Œ ëª©ë¡
- [í˜¼ì ê³µë¶€í•˜ëŠ” ì»´í“¨í„° êµ¬ì¡° + ìš´ì˜ì²´ì œ](https://velog.io/@regular_jk_kim/í˜¼ì-ê³µë¶€í•˜ëŠ”-ì»´í“¨í„°-êµ¬ì¡°-ìš´ì˜ì²´ì œ-ë¥¼-ì½ê³ )
- [í”„ë¡œê·¸ë˜ë¨¸ì˜ ê¸¸, ë©˜í† ì—ê²Œ ë¬»ë‹¤](https://velog.io/@regular_jk_kim/í”„ë¡œê·¸ë˜ë¨¸ì˜-ê¸¸-ë©˜í† ì—ê²Œ-ë¬»ë‹¤-ë¥¼-ì½ê³ -24jpq345)
- [í•¨ê»˜ ìë¼ê¸° ì• ìì¼ë¡œ ê°€ëŠ” ê¸¸](https://velog.io/@regular_jk_kim/í•¨ê»˜-ìë¼ê¸°-ë¥¼-ì½ê³ )
- [ê°ì²´ì§€í–¥ì˜ ì‚¬ì‹¤ê³¼ ì˜¤í•´](https://velog.io/@regular_jk_kim/ê°ì²´ì§€í–¥ì˜-ì‚¬ì‹¤ê³¼-ì˜¤í•´-ë¥¼-ì½ê³ )

###  ì„œí‰ ì˜ˆì • ëª©ë¡ (ì½ëŠ” ì¤‘) 
- ë©´ì ‘ì„ ìœ„í•œ CS ì „ê³µì§€ì‹ ë…¸íŠ¸

### ë…ì„œ ì˜ˆì • ëª©ë¡
- ì˜¤ë¸Œì íŠ¸
- HTTP ì™„ë²½ ê°€ì´ë“œ
- ìë°”/ìŠ¤í”„ë§ ê°œë°œìë¥¼ ìœ„í•œ ì‹¤ìš©ì£¼ì˜ í”„ë¡œê·¸ë˜ë°
- ëª¨ë˜ ìë°” ì¸ ì•¡ì…˜
- ìë°” ì„±ëŠ¥ íŠœë‹ ì´ì•¼ê¸° 
- í—¤ë“œ í¼ìŠ¤íŠ¸ ì„œë¸”ë¦¿
- íŒŒì´ë¸Œ ë¼ì¸ìŠ¤ ì˜¤ë¸Œ ì½”ë“œ

## Extras ğŸ˜€
### ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë° ìœ í‹¸
```java
@Component
public class VideoStreamingUtil {

	public VideoStreamingResponse resolve(Video video, HttpServletRequest request) {
		// Range í—¤ë” íŒŒì‹±
		String rangeHeader = request.getHeader("Range");
		long start;
		long end = video.getVideoSize() - 1;

		if (rangeHeader != null && rangeHeader.startsWith("bytes=")) {
			String[] ranges = rangeHeader.substring("bytes=".length()).split("-");
			start = Long.parseLong(ranges[0]);
			if (ranges.length > 1 && !ranges[1].isEmpty()) {
				end = Long.parseLong(ranges[1]);
			}
			if (end >= video.getVideoSize()) {
				end = video.getVideoSize() - 1;
			}
		} else {
			start = 0;
		}

		long contentLength = end - start + 1;

		// Response í—¤ë” ì„¤ì •
		HttpHeaders headers = new HttpHeaders();
		headers.setContentType(MediaType.parseMediaType("video/mp4"));
		headers.add("Accept-Ranges", "bytes");
		headers.setContentLength(contentLength);

		if (rangeHeader != null) {
			headers.set("Content-Range", String.format("bytes %d-%d/%d", start, end, video.getVideoSize()));
		}


		StreamingResponseBody streamingResponseBody = createStreamingResponse(video, start, contentLength);

		// Range ìš”ì²­ì´ ìˆìœ¼ë©´ 206, ì—†ìœ¼ë©´ 200 ë°˜í™˜
		HttpStatus status = (rangeHeader != null) ? HttpStatus.PARTIAL_CONTENT : HttpStatus.OK;
		return new VideoStreamingResponse(streamingResponseBody, status, headers);
	}

	// ìŠ¤íŠ¸ë¦¬ë° ë°”ë”” ìƒì„±
	private StreamingResponseBody createStreamingResponse(Video video, long start, long contentLength) {
		return outputStream -> {
			try (RandomAccessFile randomAccessFile = new RandomAccessFile(new File(video.getVideoPath()), "r")) {
				randomAccessFile.seek(start);
				byte[] buffer = new byte[1024];
				long bytesToRead = contentLength;

				while (bytesToRead > 0) {
					int bytesRead = randomAccessFile.read(buffer, 0, (int) Math.min(buffer.length, bytesToRead));
					if (bytesRead == -1) break;
					outputStream.write(buffer, 0, bytesRead);
					bytesToRead -= bytesRead;
				}
				outputStream.flush();
			} catch (IOException e) {
				throw new RuntimeException("Video streaming failed", e);
			}
		};
	}
}
```

### ìœ ì € í”„ë¡œí•„ ê´€ë¦¬ ìœ í‹¸
```java
@Component
public class UserUtil {

	public User buildUserWith(UserSignUpRequest userSignUpRequest, PasswordEncoder passwordEncoder) {
		return User.builder()
				.name(userSignUpRequest.username())
				.email(userSignUpRequest.email())
				.password(passwordEncoder.encode(userSignUpRequest.password()))
				.userRole(USER)
				.build();
	}

	public String saveImage(MultipartFile profileImage, User user, UserImageType userImageType) {
		if (!Objects.isNull(userImageType.getImagePathOf(user))) {
			deleteImage(userImageType.getImagePathOf(user));
		}

		String basePath = "myVideos/" + user.getId() + "/images/" + userImageType.getFolderName();
		String fileName = UUID.randomUUID() + "_" + profileImage.getOriginalFilename();
		Path filePath = Paths.get(basePath, fileName);

		try {
			Files.createDirectories(filePath.getParent());
			Files.write(filePath, profileImage.getBytes());
		} catch (IOException e) {
			throw new RuntimeException("í”„ë¡œí•„ ì‚¬ì§„ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", e);
		}
		return filePath.toString();
	}

	private void deleteImage(String imagePath) {
		Path path = Paths.get(imagePath);
		try {
			Files.deleteIfExists(path);
		} catch (IOException e) {
			throw new RuntimeException("ì´ë¯¸ì§€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", e);
		}
	}
}
```