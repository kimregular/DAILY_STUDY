## 1. XSS (Cross-Site Scripting)

### 개념

사용자의 입력값을 서버나 클라이언트가 적절히 필터링 혹은 이스케이프하지 않고 HTML, JS로 출력하는 경우, 악성 스크립트가 삽입되어 다른 사용자의 브라우저에서 실행되는 취약점.

### 공격 방식

1. Stored XSS (저장형 XSS)

- 공격자가 입력한 스크립트가 DB 등에 저장되어, 그 페이지를 본 사용자 모두가 피해를 입는 방식
- 주로 게시판, 댓글, 사용자 프로필 등에서 발생
- 예시
    - 공격자가 댓글에 `<script>alert('XSS')</script>` 입력
    - DB에 저장됨
    - 다른 사용자가 해당 글을 볼 때 script가 실행됨 → 쿠키 탈취, 세션 하이재킹, 피싱 UI 삽입 등 가능해짐

2. Reflected XSS (반사형 XSS)

- 악성 스크립트가 URL 파라미터나 검색창 등을 통해 서버에 전달되고, 그대로 HTML에 반영되어 실행되는 방식
- 예시
    - `https://searchEngine.com/search?q=](https://searchengine.com/search?q=)<script>alert(’XSS’)</script>`검색
    - 결과 : `<b><script>alert(’XSS’)</script></b>`

3. DOM-based XSS

- 서버가 아닌 클라이언트(JS)가 DOM을 조작할 때 사용자의 입력을 escape없이 innerHTML등에 넣는 경우
- 예시
    - URL에 `?q=<script>alert('XSS')</script>` 입력 시 그대로 실행
        
        ```js
        const query = location.search.split('=')[1];
        document.getElementById('result').innerHTML = query;
        ```
        

## 피해

1. 사용자의 쿠키, 세션 토큰 탈취
2. 비밀번호 탈취용 가짜 로그인 창 삽입
3. 클립보드 조작, 악성 링크 자동 클릭
4. 웹사이트 UI 변조

## 방어 방법

1. 출력 시 Escape 처리

- 예) `<script>` → `&lt;script&gt;`
```js
// 위험
element.innerHTML = userInput;

// 안전 (textContent 사용)
element.textContent = userInput;
```

1. 템플릿 엔진 사용 시 자동 Escape 확인

- **Thymeleaf**: `${userInput}`은 escape 됨, `th:utext`는 raw HTML
- **Mustache / Handlebars**: `{{msg}}`는 escape, `{{{msg}}}`는 raw

1. CSP (Content Security Policy) 설정

- 브라우저에서 스크립트 실행 정책을 제한 ( 예 : 외부 JS금지, 인라인 JS금지)

```js
Content-Security-Policy: default-src 'self'; script-src 'self'
```