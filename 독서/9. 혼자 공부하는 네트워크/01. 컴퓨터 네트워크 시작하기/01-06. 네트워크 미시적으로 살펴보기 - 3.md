# 네트워크 미시적으로 살펴보기 - 3
## 캡슐화와 역캡슐화
이번에는 지금까지 학습한 프로토콜, 네트워크 참조 모델을 토대로 실제로 패킷이 어떻게 송수신되는지 알아보겠습니다.

패킷은 송신 과정에서 캡슐화가 이루어지고, 수신 과정에서 역캡슐화가 이루어집니다. 캡슐화와 역캡슐화라는 용어가 아직은 아리송하지요? 캡슐화와 역캡슐화의 개념을 이해하려면 네트워크로 메시지를 주고받는 과정을 잘 이해해야 합니다.

네트워크 참조 모델에서 살펴본 택배 예시를 다시 확인해 볼까요? 택배는 송신자 입장에서는 가장 높은 계층에서 가장 낮은 계층으로 이동하고, 수신자 입장에서는 가장 낮은 계층에서 가장 높은 계층으로 이동합니다.

![pic1](https://theorydb.github.io/assets/img/review/review-book-network-study-alone-2.png)

네트워크 참조 모델도 마찬가지입니다. 송수신하는 메시지는 송신지 입장에서는 가장 높은 계층에서부터 가장 낮은 계층으로 이동하고, 수신지 입장에서는 가장 낮은 계층에서부터 가장 높은 계층으로 이동합니다.

![pic2](https://velog.velcdn.com/images/eunyoung224/post/b9f4e1c2-e617-4052-a4e0-9a7f61976c00/image.png)

### 캡슐화
패킷 교환 네트워크에서 메시지는 패킷 단위로 송수신됩니다. 이는 택배와 비슷한 개념이라고 했지요. 이쯤에서 패킷이 무엇이었는지 상기해 봅시다.

- 패킷은 헤더와 페이로드, 때로는 트레일러를 포함하여 구성됩니다.
- 프로토콜의 목적과 특징에 따라 헤더의 내용은 달라질 수 있습니다.

어떤 정보를 송신할 때 각 계층에서는 상위 계층으로부터 내려받은 패킷을 페이로드로 삼아, 프로토콜에 걸맞는 헤더(혹은 트레일러)를 덧붙인 후 하위 계층으로 전달합니다.

다음 쪽의 그림을 보세요. 각 계층을 지날 때마다 보내고자 하는 정보에 헤더가 추가되지요? 데이터링크 계층을 지날 때는 오류 감지를 위한 트레일러도 함께 붙습니다. 상위 계층의 패킷은 하위 계층에서의 페이로드로 간주됩니다. 페이로드를 택배 안에 담을 물품에 빗댄다면, 이는 마치 상위 계층의 택배 상자를 하위 계층의 택배 상자에 담는 것과 같습니다.

![pic3](https://velog.velcdn.com/images/eunyoung224/post/fa5990c2-5576-401f-a7d1-b938696df2b7/image.png)

즉, 한 단계 아래 계층은 바로 위의 계층으로부터 받은 패킷에 헤더 및 트레일러를 추가해 나갑니다. 이렇게 송신 과정에서 헤더 및 트레일러를 추가해 나가는 과정을 캡슐화라고 부릅니다. 혹은 영문 그대로 인캡슐레이션이라고도 부릅니다.

![pic4](https://velog.velcdn.com/images/eunyoung224/post/5e870079-dd51-4740-b2b2-29a2dcb73108/image.png)

### 역캡슐화
역캡슐화는 받는 입장에서 생각해 보면 됩니다. 택배를 수신하는 과정은 택배를 송신하는 과정의 반대입니다. 네트워크에서도 마찬가지로 어떤 메시지를 수신할 때는 캡슐화 과정에서 붙였던 헤더(및 트레일러)를 각 계층에서 확인한 뒤 제거합니다. 이를 역캡슐화라고 합니다. 영문 그대로 디캡슐레이션이라고도 부르지요. 마치 택배 상자에 붙인 송장을 떼어내고 상자 속의 상자들을 꺼내는 과정과 같습니다.

![pic5](https://velog.velcdn.com/images/eunyoung224/post/c79b7c10-8d3e-482f-b6b1-8130b236f9d2/image.png)

지금까지 프로토콜, 네트워크 참조 모델이 무엇인지 학습하고, 캡슐화와 역캡슐화 개념을 통해 통신의 흐름을 알아보았습니다.