### 참조 지역성 원리
캐시 메모리는 메모리보다 용량이 작다. 당연하게도 캐시 메모리는 메모리에 있는 모든 내용을 가져다 저장할 수는 없다. 메모리가 보조기억장치의 일부를 복사하여 저장하는 것처럼 캐시 메모리는 메모리의 일부를 복사하여 저장한다. 그렇다면 캐시 메모리는 무엇을 저장해야 할까?

보조기억장치는 전원이 꺼져도 기억할 대상을 저장하고, 메모리는 실행 중인 대상을 저장한다면 캐시 메모리는 CPU가 사용할 법한 대상을 예측하여 저장한다. 이때 자주 사용될 것으로 예측한 데이터가 실제로 들어맞아 캐시 메모리 내 데이터가 CPU에서 활용될 경우를 `캐시 히트(cache hit)`라고 한다.

반대로 자주 사용될 것으로 예측하여 캐시 메모리에 저장했지만, 예측이 틀려 메모리에서 필요한 데이터를 직접 가져와야 하는 경우를 `캐시 미스(cache miss)` 라고 한다. 캐시 미스가 발생하면 CPU가 필요한 데이터를 메모리에서 직접 가져와야 하기 때문에 캐시 메모리의 이점을 활용할 수 없다. 당연히 캐시 미스가 자주 발생하면 성능이 떨어진다.

캐시가 히트되는 비율을 `캐시 적중률(cache hit ratio)`이라 하고 다음과 같이 계산한다.

> 캐시 히트 횟수 / (캐시 히트 횟수 \* 캐시 미스 횟수)

일반적인 컴퓨터의 캐시 적중률은 대략 85 ~ 95% 이상이다. CPU가 필요할 것으로 예측한 데이터를 100번 중 85 ~ 95 번꼴로 맞추는 셈이다. 당연히 캐시 적중률이 높으면 CPU의 메모리 접근 횟수를 줄일 수 있다.

캐시 메모리의 이점을 제대로 활요하려면 CPU가 사용할 법한 데이터를 제대로 예측해서 캐시 적중률을 높여야 한다. 그렇다면 CPU가 사용할 법한 데이터는 어떻게 알 수 있을까?

캐시 메모리는 한 가지 원칙에 따라 메모리로부터 가져올 데이터를 결정한다. 바로 `참조 지역성의 원리 (locality of reference, principle of locality)`이다. 참조 지역성의 원리란 CPU가 메모리에 접근할 때의 주된 경향을 바탕으로 만들어진 원리이다.

1. CPU는 최근에 접근했던 메모리 공간에 다시 접근하려는 경향이 있다.
2. CPU는 접근한 메모리 공간 근처를 접근하려는 경향이 있다.

하나씩 자세히 알아보자.

####  1. 최근에 접근했던 메모리 공간에 다시 접근하려는 경향
프로그래밍 언어를 배웠다면 '변수'가 무엇인지 알 것이다. 변수에 값을 저장하고 나면 언제든 변수에 다시 접근하여 변수에 저장된 값을 사용할 수 있다. 이는 달리 말해 'CPU는 변수가 저장된 메모리 공간을 언제든 다시 참조할 수 있다'는 것을 의미한다. 그리고 변수에 저장된 값은 일반적으로 한 번만 사용되지 않고 프로그램이 실행되는 동안 여러 번 사용한다. 즉, CPU는 최근에 접근했던 (변수가 저장된) 메모리 공간을 여러 번 다시 접근할 수 있다.

아래 코드를 보자. 구구단 2단을 출력하는 간단한 코드이다.
```c
#include <stdio.h>

int main(void){
	int num = 2;

	for(int i = 1; i <= 9; i++)
		printf("%d X %d = %d\n", num, i, num * i);

	return 0;
}
```

위 코드에서 변수는 num 과 i 이다. 구구단 2단을 출력하는 과정에서 이 변수들이 여러 번 사용되고 있다. 이렇게 '최근에 접근했던 메모리 공간에 다시 접근하려는 경향'을 `시간 지역성 (temporal locality)` 이라고 한다.

#### 2. 접근한 메모리 공간 근처를 접근하려는 경향
CPU가 실행하려는 프로그램은 보통 관련 데이터들끼리 한데 모여 있다. 가령 메모리 내에 워드 프로세서 프로그램, 웹 브라우저 프로그램, 게임 프로그램이 있다고 가정해보자. 이 세 프로그램은 서로 관련 있는 데이터끼리 모여서 저장된다. 워드 프로세서 프로그램은 워드 프로세서 관련 데이터들이 모여 저장되고, 웹 브라우저 프로그램은 웹 브라우저 관련 데이터들이 모여 저장되고, 게임 프로그램은 게임 관련 데이터들이 모여 저장된다.

그리고 하나의 프로그램 내에서도 관련 있는 데이터들은 모여서 저장된다. 가령 워드 프로세서 프로그램에 자동 저장 기능, 입력 기능, 출력 기능이 있다고 했을 때 각 기능과 관련한 데이터는 모여 저장된다.

CPU가 워드 프로세서 프로그램을 실행할 적에는 워드 프로세서 프로그램이 모여 있는 공간 근처를 집중적으로 접근할 것이고, 사용자가 입력할 할 적에는 입력 기능이 모여 있는 공간 근처를 집중적으로 접근한다. 이렇게 '접근한 메모리 공간 근처를 접근하려는 경향'을 `공간 지역성 (spatial locality)`이라고 한다.

캐시 메모리는 이렇듯 참조 지역성의 원리에 입각해 CPU가 사용할 법한 데이터를 예측한다.