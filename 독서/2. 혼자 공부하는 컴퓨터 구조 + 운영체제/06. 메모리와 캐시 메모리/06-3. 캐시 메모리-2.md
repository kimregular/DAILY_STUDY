### 캐시 메모리
CPU가 메모리에 접근하는 속도는 레지스터에 접근하는 속도보다 느리다. 그럼에도 불구하고 CPU는 프로그램을 실행하는 과정에서 메모리에 빈번히 접근해야만 한다. CPU 연산 속도가 아무리 빨라도 메모리에 접근하는 속도가 그에 따라가지 못한다면 CPU의 발전은 아무 소용이 없을 것이다.

그래서 등장한 저장 장치가 캐시 메모리이다. `캐시 메모리 (cache memory)`는 CPU와 메모리 사이에 위치하고, 레지스터보다 용량이 크고 메모리보다 빠른 SRAM 기반의 저장 장치이다.

캐시 메모리는 CPU의 연산 속도와 메모리 접근 속도의 차이를 조금이나마 줄이기 위해 탄생했다. CPU가 매번 메모리에 왔다 갔다 하는 건 시간이 오래 걸리니, 메모리에서 CPU가 사용할 일부 데이터를 미리 캐시 메모리로 가지고 와서 활용하자는 것이다.

CPU를 집으로, 메모리에 접근하는 행위를 물건을 사러 가는 것으로 비유하자면 메모리는 마치 '물건은 많지만 집과는 멀리 떨어져 있어 왕복이 오래 걸리는 대형 마트'이고, 캐시 메모리는 '물건이 많지는 않아도 집과 가까이 있는 편의점'과 같다고 보면 된다.

편의점에 내가 필요한 물품이 있다면 굳이 멀리 있는 대형 마트까지 갈 필요 없이 내가 원하는 물품을 얻을 수 있는 것처럼 캐시 메모리에 CPU가 필요로 하는 데이터가 있다면 필요한 데이터로의 접근 시간을 줄일 수 있다.

캐시 메모리까지 반영한 저장 장치 계층 구조는 아래와 같다.

![메모리 계층 구조2](<images/Memory Hierarchy.002.jpeg>)

우리가 사용하는 컴퓨터 내부에는 어려 개의 캐시 메모리가 있다. 그리고 이 캐시 메모리들은 CPU와 가까운 순서대로 계층을 구성한다. 코어와 가장 가까운 캐시 메모리를 `L1 (level 1) 캐시`, 그다음 가까운 캐시 메모리를 `L2(level2) 캐시`, 그다음 가까운 캐시 메모리를 `L3(level 3) 캐시` 라고 부른다.

![메모리 계층 구조3](<images/Memory Hierarchy.003.jpeg>)
(일반적으로 L1 캐시와 L2 캐시는 코어 내부에, L3 캐시는 코어 외부에 있다.)

저장 장치 계층 구조를 이해했다면 짐작할 수 있다시피 캐시 메모리의 용량은 L1, L2, L3 순으로 커지고, 속도는 L3, L2, L1 순으로 빨라진다. 가격은 일반적으로 L3, L2, L1 순으로 비싸진다. CPU가 메모리 내에 데이터가 필요하다고 판단하면 우선 L1 캐시에 해당 데이터가 있는지를 알아보고, 없다면 L2, L3 캐시 순으로 데이터를 검색한다.

멀티 코어 프로세서에서 L1-L2-L3 캐시는 일반적으로 다음과 같이 구현된다. L1 캐시와 L2 캐시는 코어마다 고유한 캐시 메모리로 할당되고, L3 캐시는 여러 코어가 공유하는 형태로 사용된다.

![메모리 계층 구조4](<images/Memory Hierarchy.004.jpeg>)

코어와 가장 가까운 L1 캐시는 조금이라도 접근 속도를 빠르게 만들기 위해 명령어만을 저장하는 L1 캐시인 L1I 캐시와 데이터만을 저장하는 L1 캐시인 L1D 캐시로 분리하는 경우도 있다. 이를 `분리형 캐시 (split cache)`라고 한다.

캐시 메모리의 계층 구조를 알았다면 이제 저장 장치 계층 구조를 세부적으로 그릴 수 있다.

![메모리 계층 구조5](<images/Memory Hierarchy.005.jpeg>)

이 구조를 외울 필요는 없다. 중요한 것은 상위 계층을 이루고 있는 저장 장치의 특징과 하위 계층을 이루고 있는 저장 장치의 특징을 이해하고 그 차이를 이해하는 것이다.