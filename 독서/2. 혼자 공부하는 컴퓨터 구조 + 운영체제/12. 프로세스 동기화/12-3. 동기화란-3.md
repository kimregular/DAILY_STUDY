### 공유 자원과 임계 구역
그렇다면 동시에 접근해서는 안 되는 자원이란 무엇일까?

계좌 잔액 문제와 생산자 소비자 문제의 예시에서 동시에 실행되는 프로세스들은 전역 변수 '잔액', '총합'이라는 공동의 자원을 두고 작업을 했다. 이러한 자원을 `공유 자원 (shared resource)`이라고 한다. 공유 자원은 전역 변수가 될 수도 있고, 파일이 될 수도 있고, 입출력장치, 보조기억장치가 될 수도 있다.

그리고 이 공유 자원 중에는 두 개 이상의 프로세스를 동시에 실행하면 문제가 발생하는 자원이 있다. 앞서 보여준 계좌 잔액 문제에서 '잔액' 변수, 그리고 생산자 소비자 문제에서 '총합' 변수가 이런 자원에 해당한다. 이렇게 동시에 실행하면 문제가 발생하는 자원에 접근하는 코드 영역을 `임계 구역 (critical section)`이라고 한다.

두 개 이상의 프로세스가 임계 구역에 진입하고자 하면 둘 중 하나는 대기해야 한다. 임계 구역에 먼저 진입한 프로세스의 작업이 마무리되면 그제서야 비로소 기다렸던 프로세스가 임계 구역에 진입한다.

![criticalSection.001.jpeg](<images/criticalSection.001.jpeg>)

임계 구역은 두 개 이상의 프로세스가 동시에 실행되면 안 되는 영역이지만, 잘못된 실행으로 인해 여러 프로세스가 동시 다발적으로 임계 구역의 코드를 실행하여 문제가 발생하는 경우가 있다. 이를 `레이스 컨디션 (race condition)`이라고 한다.

레이스 컨디션이 발생하면 계좌 잔액 문제나 생산자와 소비자 문제처럼 데이터의 일관성이 깨지는 문제가 발생한다. 즉, 계좌 잔액 문제와 생산자와 소비자 문제는 레이스 컨디션의 사례로 볼 수 있다.

레이스 컨디션이 발생하는 근본적인 이유를 따져 보자. 이전에 '고급 언어는 실행 과정에서 저급 언어로 변환되어 실행된다'고 했었다.

가령 생산자 소비자 문제에서 '총합을 1 증가시킨다' 혹은 '총합을 1 감소시킨다'라는 코드는 고급 언어 한 줄로 작성할 수 있지만, 이는 컴퓨터 내부에서 대략 다음과 같이 여러 줄의 저급 언어로 변환되어 실행된다.

```
총합++; //총합 변수를 1 증가시키는 코드
```

⬇️

```
r1 = 총합; // 총합 변수를 레지스터에 저장
r1 = r1 + 1; // 레지스터 값 1 증가
총합 = r1; // 레지스터 값을 총합 변수에 저장
```

-------

```
총합--; //총합 변수를 1 감소시키는 코드
```

⬇️

```
r1 = 총합; // 총합 변수를 레지스터에 저장
r1 = r1 - 1; // 레지스터 값 1 감소
총합 = r1; // 레지스터 값을 총합 변수에 저장
```

컴퓨터는 고급 언어가 아닌 저급 언어를 실행하기 때문에 여러 줄의 저급 언어로 변환된 고급 언어 한 줄을 실행하는 과정에서 문맥 교환이 일어날 수 있다. 저급 언어를 실행하는 과정에서 문맥 교환이 일어난다면 아래와 같은 문제가 발생한다.

![criticalSection.002.jpeg](<images/criticalSection.002.jpeg>)

이때, 상호 배제를 위한 동기화는 이와 같은 일이 발생하지 않도록 두 개 이상의 프로세스가 임계 구역에 동시에 접근하지 못하도록 관리하는 것을 의미한다.

운영체제는 이러한 임계 구역 문제를 아래 세 가지 원칙 하에 해결한다. 달리 말해 상호 배제를 위한 동기화를 위해서는 아래 세 가지 원칙이 반드시 지켜져야만 한다.

- `상호 배제 (mutual exclusion)` : 한 프로세스가 임계 구역에 진입했다면 다른 프로세스는 임계 구역에 들어올 수 없다.
- `진행 (progress)` : 임계 구역에 어떤 프로세스도 진입하지 않았다면 임계 구역에 진입하고자 하는 프로세스는 들어갈 수 있어야 한다.
- `유한 대기 (bounded waiting)` : 한 프로세스가 임계 구역에 진입하고 싶다면 그 프로세스는 언젠가는 임계 구역에 들어올 수 있어야 한다(임계 구역에 들어오기 위해 무한정 대기해서는 안 된다).

