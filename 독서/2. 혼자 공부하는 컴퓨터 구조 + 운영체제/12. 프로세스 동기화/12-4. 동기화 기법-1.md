앞서 동기화의 의미와 동기화를 하지 않았을 때 발생할 수 있는 대표적인 문제 상황, 그리고 공유 자원과 임계 구역에 대해서 알아봤다.

그렇다면 프로세스의 동기화는 어떻게 이루어질까? 어떻게 해야 임계 구역에 오직 하나의 프로세스만 진입하게 하고, 올바른 실행 순서를 보장할 수 있을까? 이를 위해 동기화를 위한 대표적인 도구인 `뮤텍스 락`, `세마포`, `모니터`를 알아보자.

### 뮤텍스 락
임계 구역 문제와 이를 이를 해결하기 위한 동기화를 옷 가게에서 탈의실을 이용하는 것에 비유해보자. 옷 가게에서 마음에 드는 옷이 있으면 손님은 탈의실에 들어가서 옷을 입어볼 수 있다. 이때 탈의실에는 한 명의 인원만 들어갈 수 있다. 손님들은 탈의실이라는 자원을 이용하고 탈의실 안에는 손님 한 명씩만 들어올 수 있으니, 손님은 '프로세스', 탈의실은 '임계 구역'이라고 할 수 있다.

만일 밖에서 탈의실에 사람이 있는지 없는지 알 수 없는 상황이라면 어떻게 탈의실이 이용중임을 알 수 있을까? 일단 탈의실을 열어 보고 자물쇠가 걸려 있다면 탈의실 안에 사람이 있다고 판단하고 기다린다. 자물쇠가 걸려 있지 않다면 탈의실을 이용하면 되는 것이다.

이 자물쇠 기능을 코드로 구현한 것이 `뮤텍스 락 (Mutex lock : MUTual EXclusion lock)`이다. 뮤텍스 락은 동시에 접근해서는 안 되는 자원에 동시에 접근하지 않도록 만드는 도구, 다시 말해 상호 배제를 위한 동기화 도구이다.

임계 구역에 진입하는 프로세스는 '내가 지금 임계 구역에 있음'을 알리기 위해 뮤텍스 락을 이용해 임계 구역에 자물쇠를 걸어둘 수 있고, 다른 프로세스는 임계 구역이 잠겨 있다면 기다리고, 잠겨 있지 않다면 임계 구역에 진입할 수 있다.

뮤텍스 락의 매우 단순한 형태는 하나의 전역 변수와 두 개의 함수로 구현할 수 있다.

- 자물쇠 역할 : 프로세스들이 공유하는 전역 변수 lock
- 임계 구역을 잠그는 역할 : acquire 함수
- 임계 구역의 잠금을 해제하는 역할 : release 함수

`acquire 함수`는 프로세스가 임계 구역에 진입하기 전에 호출하는 함수이다. 만일 임계 구역이 잠겨 있다면 임계 구역이 열릴 때까지 (lock이 false가 될 때까지) 임계 구역을 반복적으로 확인하고, 임계 구역이 열려 있다면 임계 구역을 잠그는 (lock을 true로 바꾸는) 함수이다.

`release 함수`는 임계 구역에서의 작업이 끝나고 호출하는 함수이다. 현재 잠긴 임계 구역을 열어주는 (lock을 false로 바꾸는) 함수라고 보면 된다.

```js
acquire(){
	while(lock == true){ // 만약 임계 구역이 잠겨 있다면
		;                // 임계 구역이 잠겨 있는지를 반복적으로 확인
	}
	lock = true;         // 만약 임계 구역이 잠겨 있지 않다면 임계 구역 잠금
}

release(){
	lock = false;        // 임계 구역 작업이 끝났으니 잠금 해제
}
```

acquire와 release함수를 아래와 같이 임계 구역 전후로 호출함으로써 하나의 프로세스만 임계 구역에 진입할 수 있다.

```js
acquire();               // 자물쇠 잠겨 있는지 확인, 잠겨 있지 않다면 잠그고 들어가기
// 임계 구역               // 임계 구역에서의 작업 진행
release();               // 자물쇠 반환
```

이렇게 되면 프로세스는

- 락을 획득할 수 없다면(임계 구역에 진입할 수 없다면) 무작정 기다리고,
- 락을 획득할 수 있다면 (임계 구역에 진입할 수 있다면) 임계 구역을 잠근 뒤 임계 구역에서의 작업을 진행하고,
- 임계 구역에서 빠져나올 때엔 다시 임계 구역의 잠금을 해제함으로써

임계 구역을 보호할 수 있다.

참고로 acquire 함수를 다시 보면 임계 구역이 잠겨 있을 경우 프로세스는 반복적으로 lock을 확인하는 것을 알 수 있다.

이는 마치 탈의실 문이 잠겨 있는지 쉴 새 없이 반복하며 확인해 보는 것과 같다. 이런 대기 방식을 `바쁜 대기(busy wait)`라고 한다.

