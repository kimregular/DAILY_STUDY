### 생산자와 소비자 문제
상호 배제를 위한 동기화에 대해 조금만 더 알아보자. 이와 관련된 고전적이고 유명한 문제로 `생산자와 소비자 문제`가 있다. 생산자와 소비자 문제는 물건을 계속해서 생산하는 프로세스인 생산자와 물건을 계속해서 소비하는 프로세스인 소비자로 이루어져 있다. 생산자와 소비자는 동시에 실행되는 스레드가 될 수도 있다.

생산자와 소비자는 '총합'이라는 데이터를 공유하고 있다. 생산자는 버퍼에 물건을 넣은 후, 물건의 총합에 해당하는 변수를 1 증가시키고, 소비자는 버퍼에 물건을 빼낸 후 물건의 총합에 해당하는 변수를 1 감소시킨다.

`생산자`
```js
생산자() {
	버퍼에 데이터 삽입
	'총합' 변수 1 증가
}
```

`소비자`
```js
소비자() {
	버퍼에서 데이터 빼내기
	'총합' 변수 1 감소
}
```

물건이 처음에 10개 있었다고 가정한다. 다시 말해 물건의 총합 변수를 10으로 초기화 한다.

```js
총합 = 10

생산자() {
	버퍼에 데이터 삽입
	'총합' 변수 1 증가
}

소비자() {
	버퍼에서 데이터 빼내기
	'총합' 변수 1 감소
}
```

위와 같은 상태에서 생산자를 100000번, 소비자를 100000번 동시에 실행한다. 실행 결과 총합은 몇일까? 언뜻 보기에 코드는 아무런 문제가 없어 보인다. 생산자는 그저 버퍼에 데이터를 넣고 총합을 1 증가시킬 뿐이고, 소비자는 버퍼에서 데이터를 빼고 총합을 1 감소시킬 뿐이다. 

하지만 막상 생산자와 소비자를 동시에 실행해 보면 예상치 못한 결과를 받을 수 있다. 총합이 10이 아닌 다른 수가 되거나 실행 중 오류가 나기도 한다.

```
초기 합계 : 10
producer, consumer 스레드 실행 이후 합계 : 63078
```

```
초기 합계 : 10
producer, consumer 스레드 실행 이후 합계 : -13750
```

이는 생산자 프로세스와 소비자 프로세스가 제대로 동기화되지 않았기 때문에 발생한 문제이다. 생산자와 소비자는 '총합'이라는 데이터를 동시에 사용하는데, 앞서의 예시에서는 소비자가 생산자의 작업이 끝나기도 전에 총합을 수정했고, 생산자가 소비자의 작업이 끝나기도 전에 총합을 수정했기 때문에 엉뚱한 결과가 발생한 것이다. 한 마디로 계좌 잔액 문제와 생산자 소비자 문제는 동시에 접근해서는 안 되는 자원에 동시에 접근했기에 발생한 문제라고 볼 수 있다.