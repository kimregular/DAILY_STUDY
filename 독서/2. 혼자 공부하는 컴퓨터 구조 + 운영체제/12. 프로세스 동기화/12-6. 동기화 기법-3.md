### 모니터
세마포는 그 자체로 매우 훌륭한 프로세스 동기화 도구이지만, 사용하기가 조금 불편한 면이 있다. 매번 임계 구역에 앞뒤로 일일이 wait와 signal 함수를 명시하는 것은 번거로운 일이기 때문이다. 더군다나 자칫 아래처럼 잘못된 코드로 인해 예기치 못한 결과를 얻을 수도 있다. 설마 저런 것을 헷갈릴까 싶을 수도 있겠으나 코드가 방대해지고 복잡해지면 아래와 같은 상황은 얼마든지 발생할 수 있다.

#### 세마포의 잘못된 예시
![모니터.001.jpeg](<images/모니터.001.jpeg>)

###

이에 최근에 등장한 동기화 도구가 `모니터 (mornitor)`이다. 모니터는 세마포에 비하면 사용자가 사용하기에 훨씬 편리한 동구이다. 다음 그림으로 이해해 보자. 모니터는 그림처럼 공유 자원과 공유 자원에 접근하기 위한 인터페이스(통로)를 묶어 관리한다. 그리고 프로세스는 반드시 인터페이스를 통해서만 공유 자원에 접근하도록 한다.

![모니터.002.jpeg](<images/모니터.002.jpeg>)

이를 위해 모니터를 통해 공유 자원에 접근하고자 하는 프로세스를 큐에 삽입하고, 큐에 삽입된 순서대로 하나씩 공유 자원을 이용하도록 한다. 즉, 모니터는 공유 자원을 다루는 인터페이스에 접근하기 위한 큐 (모니터에 진입하기 위한 큐)를 만들고, 모니터 안에 항상 하나의 프로세스만 들어오도록하여 상호 배제를 위한 동기화를 제공한다.

![모니터.003.jpeg](<images/모니터.003.jpeg>)

이 밖에도 모니터는 세마포와 마찬가지로 실행 순서 제어를 위한 동기화도 제공한다. 특정 조건을 바탕으로 프로세스를 실행하고 일시 중단하기 위해 모니터는 `조건 변수(condition variable)`를 사용하는데, 조건 변수는 프로세스나 스레드의 실행 순서를 제어하기 위해 사용하는 특별한 변수이다. (모니터가 조건 변수를 사용한다고는 하지만 조건 변수와 모니터는 별개의 개념이다)

조건 변수로는 wait와 signal 연산을 수행할 수 있다. 우선 wait는 호출한 프로세스의 상태를 대기 상태로 전환하고 일시적으로 조건 변수에 대한 대기 큐에 삽입하는 연산이다. 여기서 헷갈리면안 되는 점은 모니터에 진입하기 위해 삽입되는 큐(상호 배제를 위한 큐)와 wait가 호출되어 실행이 중단된 프로세스들이 삽입되는 큐(조건 변수에 대한 큐)는 다르다는 점이다. 전자는 모니터에 한 번에 하나의 프로세스만 진입하도록 하기 위해 만들어진 큐이고, 후자는 모니터에 이미 진입한 프로세스의 실행 조건이 만족될 때까지 잠시 실행이 중단되어 기다리기 위해 만들어진 큐이다.

![모니터.004.jpeg](<images/모니터.004.jpeg>)

모니터에 진입한 어떤 프로세스가 x.wait()를 통해 조건 변수 x에 대한 wait를 호출했다고 가정해 보자. 그 프로세스는 다음 그림처럼 조건 변수 x에 대한 큐에 삽입되므로 모니터는 다시 비게 된다. 그렇기에 다른 프로세스가 모니터 안에 들어올 수 있는 것이다.

![모니터.005.jpeg](<images/모니터.005.jpeg>)

wait 연산으로 일시 중지된 프로세스는 다른 프로세스의 signal 연산을 통해 실행이 재개될 수 있다. 즉, signal은 wait를 호출하여 큐에 삽입된 프로세스의 실행을 재개하는 연산이다. 가령 어떤 프로세스가 x.signal()을 통해 조건 변수 x에 대한 signal을 호출했다고 가정해 보자. 이를 통해 조건 변수 x에 대해 대기 상태에 있던 프로세스가 깨어나 모니터 안으로 다시 들어올 수 있게 된다.

![모니터.006.jpeg](<images/모니터.006.jpeg>)

모니터 안에는 하나의 프로세스만이 있을 수 있다. 따라서 wait를 호출했던 프로세스는 signal을 호출한 프로세스가 모니터를 떠난 뒤에 실행되거나, signal을 호출한 프로세스의 실행을 일시 중단하고 자신이 실행된 뒤 다시 signal을 호출한 프로세스의 수행을 재개한다. 중요한 점은 모니터는 조건 변수를 이용하여 아래와 같은 프로세스 실행 순서 제어를 위한 동기화를 제공한다는 사실이다.

1. 특정 프로세스가 아직 실행될 조건이 되지 않았을 때에는 wait를 통해 실행을 중단한다.
2. 특정 프로세스가 실행될 조건이 충족되었을 때에는 signal을 통해 실행을 재개한다.

지금까지 동기화의 개념과 이를 위한 도구를 알아봤다.