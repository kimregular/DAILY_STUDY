도심 속 도로에서 차가 꽉 막혀 꼼짝달싹 못하는 상황을 경험한 적이 있다. 이렇게 교통이 마비되어 버리면 복구되기까지 오랜 시간이 걸릴 뿐더러, 심한 경우 교통 경찰이 직접 와서 마비를 해결해야 한다.

프로세스 실행 과정에도 이와 비슷한 문제가 있다. 프로세스를 실행하기 위해서는 자원이 필요한데, 두 개 이상의 프로세스가 각자 가지고 있는 자원을 무작정 기다린다면 그 어떤 프로세스도 더 이상 진행할 수 없는 교착 상태가 된다. `교착 상태`는 정확히 무엇이며, 언제 어떻게 발생하는지 알아보자.

### 식사하는 철학자 문제
`식사하는 철학자 문제 (dining philosophers problem)`는 교착 상태를 설명하기 위한 아주 고전적이고 재미있는 문제 상황이다. 이 유명한 문제는 교착 상태가 어떤 상황에서 왜 발생하는지, 나아가 교착 상태를 어떻게 해결할 수 있는지를 엿볼 수 있는 가상의 문제 시나리오이다.

동그란 원탁에 다섯 명의 철학자가 앉아 있다. 이 철학자들 앞에는 맛있는 식사가 있고, 철학자들 사이 사이에는 식사에 필요한 포크가 있다. 그리고 철학자들 앞에 있는 식사는 두 개의 포크로 먹을 수 있는 음식이라 가정한다.

그리고 이 철학자들은 아래와 같은 순서로 식사를 한다.

1. 계속 생각을 하다가 왼쪽 포크가 사용 가능하면 집어든다.
2. 계속 생각을 하다가 오른쪽 포크가 사용 가능하면 집어든다.
3. 왼쪽과 오른쪽 포크를 모두 집어들면 정해진 시간동안 식사를 한다.
4. 식사 시간이 끝나면 오른쪽 포크를 내려놓는다.
5. 오른쪽 포크를 내려놓은 뒤 왼쪽 포크를 내려놓는다.
6. 다시 1번부터 반복한다.

과연 이 철학자들은 식사를 무사히 마칠 수 있을까? 언뜻 보면 위 순서에는 아무런 문제가 없어 보인다. 실제로도 한두 명의 철학자가 식사할 때는 아무런 문제가 없다.

하지만 모든 철학자가 동시에 포크를 집어 식사를 하면 어떤 철학자도 식사를 할 수 없고 영원히 생각만 하는 상황이 발생할  수 있다. 모든 철학자가 왼쪽 포크를 집어들면 모두가 오른쪽 포크를 집어들 수 없기 때문이다. 다시 말해 모든 철학자는 다른 철학자가 포크를 내려놓을 때까지 기다린다.

이렇게 일어나지 않을 사건을 기다리며 진행이 멈춰 버리는 현상을 `교착 상태 (deadlock)`라고 한다.

식사하는 철학자 문제에서 철학자는 프로세스 혹은 스레드, 포크는 자원, 생각하는 행위는 자원을 기다리는 것에 빗대어 볼 수 있다. 그리고 포크는 한 번에 하나의 프로세스 혹은 스레드만 접근할 수 있으니 임계 구역이라고 볼 수 있다.

이는 마치 게임 프로세스는 자원 A를 점유한 채 웹 브라우저 프로세스가 점유하고 있는 자원 B의 사용이 끝나길 기다리고, 웹 브라우저 프로세스는 자원 B를 점유한 채 게임 프로세스의 자원A 사용이 끝나길 기다리는 상황과 같다. 이 경우 게임과 웹 브라우저 프로세스는 상대방이 가진 자원을 기다리기만 하다가 결국 실행 한 번 못하는 상황이 벌어진다. 이를 교착 상태라고 한다.

교착 상태는 아주 다양한 상황에서 발생한다. 앞서 배운 뮤텍스 락에서도 교착 생태는 발생할 수 있다. 예를 들어 프로세스 A는 임계 구역 진입 전 lock1을 잠그고 (lock1 = true;), 프로세스 B는 임계 구역 진입 전 lock2를 잠갔다고 (lock2 = true;) 가정하자. 만일 프로세스 A는 lock2가 false 가 되길 기다리고, 프로세스 B는 lock1 이 false가 되길 기다린다면 교착 상태가 발생한다.

이러한 교착 상태를 해결하기 위해서는 첫째, 교착 상태가 발생했을 때의 상황을 정확히 표현해 보고, 둘째, 교착 상태가 일어나는 근본적인 이유에 대해 알아야 한다. 그렇다면 우선 교착 상태가 발생했을 때의 상황을 한 눈에 보기 쉽게 그래프로 표현하는 방법을 알아보자.