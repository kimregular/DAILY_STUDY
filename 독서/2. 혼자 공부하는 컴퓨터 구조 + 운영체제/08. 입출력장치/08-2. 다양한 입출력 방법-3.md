### DMA 입출력
앞에서 설명한 프로그램 기반 입출력과 인터럽트 기반 입출력에 공통점이 있다면 입출력장치와 메모리 간의 데이터 이동은 CPU가 주도하고, 이동하는 데이터도 반드시 CPU를 거친다는 점이다.

예를 들어 입출력장치 데이터를 메모리에 저장하는 경우 CPU는 장치 컨트롤러에서 입출력장치 데이터를 하나씩 읽어 레지스터에 적재하고, 적재한 데이터를 메모리에 저장한다.

메모리 속 데이터를 입출력장치에 내보내는 경우도 마찬가지이다. CPU는 메모리에서 데이터를 하나씩 읽어 레지스터에 적재하고, 적재한 데이터를 하나씩 입출력장치에 내보낸다.

입출력장치와 메모리 사이에 전송되는 모든 데이터가 반드시 CPU를 거쳐야 한다면 가뜩이나 바쁜 CPU는 입출력장치를 위한 연산 때문에 시간을 뻇기게 된다. 하드 디스크 백업과 같이 대용량 데이터를 옮길 때는 CPU 부담이 더욱 커진다. 그래서 입출력장치와 메모리가 CPU는 거치지 않고도 상호작용할 수 있는 입출력 방식인 `DMA(Direct Memory Access)`가 등장했다. DMA는 이름 그대로 직접 메모리에 접근할 수 있는 입출력 기능이다. DMA 입출력을 하기 위해서는 시스템 버스에 연결된 `DMA 컨트롤러`라는 하드웨어가 필요하다.

#### DMA 입출력 과정
일반적으로 DMA 입출력은 아래와 같이 이루어진다.
1. CPU는 DMA 컨트롤러에 입출력장치의 주소, 수행할 연산(읽기/쓰기), 읽거나 쓸 메모리의 주소 등과 같은 정보로 입출력 작업을 명령한다.
2. DMA 컨트롤러는 CPU 대신 장치 컨트롤러와 상호작용하며 입출력 작업을 수행한다. 이때 DMA 컨트롤러는 필요한 경우 메모리에 직접 접근하여 정보를 읽거나 쓴다.
3. 입출력 작업이 끝나면 DMA 컨트롤러는 CPU에 인터럽트를 걸어 작업이 끝났음을 알린다.

이번에는 메모리 내의 정보를 하드 디스크에 백업하는 작업이 DMA 입출력으로 어떻게 이루어지는지도 알아보자.

1. CPU는 DMA 컨트롤러에 하드 디스크 주소, 수행할 연산(쓰기), 백업할 내용이 저장된 메모리의 주소 등의 정보와 함께 입출력 작업을 명령한다.
2. DMA 컨트롤러는 CPU를 거치지 않고 메모리와 직접 상호작용하며 백업할 정보를 읽어오고, 이를 하드 디스크의 장치 컨트롤러에 내보낸다.
3. 백업이 끝나면 DMA 컨트롤러는 CPU에게 인터럽트를 걸어 작업이 끝났음을 알린다.

입출력 과정을 보면 알 수 있듯 입출력장치와 메모리 사이에 주고받을 데이터는 CPU를 거치지 않는다. CPU는 DMA 컨트롤러에게 입출력 작업 명령을 내리고, 인터럽트만 받으면 되기 때문에 작업 부담을 훨씬 줄일 수 있다. 다시 말해 CPU는 오로지 입출력의 시작과 끝에만 관여하면 된다.

그런데 여기서 생각해 봐야 할 문제가 있다. DMA 컨트롤러는 시스템 버스로 메모리에 직접 접근이 가능하지만, 시스템 버스는 동시 사용이 불가능하다. 시스템 버스는 공용 자원이기 때문이다. CPU가 시스템 버스를 사용할 때 DMA 컨트롤러는 시스템 버스를 사용할 수 없고, DMA 컨트롤러가 시스템 버스를 사용할 때는 CPU가 시스템 버스를 사용할 수 없다.

그래서 DMA 컨트롤러는 CPU가 시스템 버스를 이용하지 않을 때마다 조금씩 시스템 버스를 이용하거나, CPU가 일시적으로 시스템 버스를 이용하지 않도록 허락을 구하고 시스템 버스를 집중적으로 이용한다. CPU 입장에서는 마치 버스에 접근하는 주기를 도둑 맞는 기분이 들 수 있다. 그래서 이러한 DMA의 시스템 버스 이용을 `사이클 스틸링(cycle stealing)`이라고 부른다.

#### 입출력 버스
마지막으로 DMA 컨트롤러와 장치 컨트롤러의 연결방식과 입출력 버스에 대해 알아보자.

CPU, 메모리, DMA 컨트롤러, 장치 컨트롤러가 모두 같은 버스를 공유하는 구성에서는 DMA를 위해 한 번 메모리에 접근할 때마다 시스템 버스를 두 번 사용하게 되는 부작용이 있다. 앞서 예시를 들었던 메모리 내 정보를 하드 디스크로 백업하는 상황을 다시 생각해 보자.

이 경우 메모리에서 DMA 컨트롤러로 데이터를 가져오기 위해 시스템 버스를 한 번 사용하고, DMA 컨트롤러의 데이터를 장치 컨트롤러로 옮기기 위해 시스템 버스를 또 한 번 사용한다.

DMA를 위해 시스템 버스를 너무 자주 사용하면 그만큼 CPU가 시스템 버스를 이용하지 못한다. 이 문제는 DMA 컨트롤러와 장치 컨트롤러들을 `입출력 버스 (input/output bus)`라는 별도의 버스에 연결하여 해결할 수 있다. 장치 컨트롤러가 서로 데이터를 전송할 때는 시스템 버스를 이용할 필요가 없으므로 시스템 버스의 사용 빈도를 줄일 수 있다.

현대 대부분 컴퓨터에는 입출력 버스가 있다. 다시 말해 대부분의 입출력장치(장치 컨트롤러)는 시스템 버스가 아닌 입출력 버스와 연결된다. 이런 점에서 볼 때 입출력 버스는 입출력장치를 컴퓨터 내부와 연결 짓는 통로라고도 볼 수 있다.

입출력 버스에는 `PCI(Peripheral Component Interconnect) 버스, PCI Express(PCIe) 버스`  등 여러 종류가 있다. 

**더욱 발전한 DMA, 입출력 채널**
DMA를 통해 입출력장치와 메모리가 CPU를 거치지 않고 직접 데이터를 주고받을 수 있게 되었지만, 여전히 입출력 명령어를 인출하고, 해석하고, 실행하는 역할은 상당 부분 CPU의 몫이었다. 그래서 최근에는 메모리에 직접 접근할 뿐만 아니라 입출력 명령어를 직접 인출하고, 해석하고, 실행까지 하는 일종의 입출력 전용 CPU가 만들어졌는데, 이를 `입출력 프로세서(IOP : Input/Output Processor` 혹은 `입출력 채널 (Input/Output Channel)`이라고 부른다. 실제로 일부 최신 입출력장치 내부에는 별도의 CPU가 포함되어 있는 걸 볼 수 있다.
입출력 채널이 있는 컴퓨터에서는 CPU가 입출력 명령어를 실행하지 않는다. CPU가 입출력 채널에게 메모리에 저장된 특정 입출력 명령어를 수행하라고 지시하면, 입출력 채널은 해당 입출력 명령어를 인출하고, 해석하고, 실행한 뒤, 인터럽트를 통해 결과를 CPU에게 알린다.